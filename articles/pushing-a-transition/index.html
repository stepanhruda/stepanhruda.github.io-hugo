<!DOCTYPE html>
<html>
<head>
	<link href="http://gmpg.org/xfn/11" rel="profile">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<link rel="canonical" href="http://www.stepan.technology/articles/pushing-a-transition" />
	<meta name="description" content="Putting the easy into easy transitioning" />
	<meta property="og:description" content="Putting the easy into easy transitioning" />
	<meta itemprop="image" content="http://www.stepan.technology/assets/images/icon.jpeg" />
	<meta property="og:image" content="http://www.stepan.technology/assets/images/icon.jpeg" />
	<meta property="og:title" content="Part 1: Pushing a transition" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="http://www.stepan.technology/articles/pushing-a-transition" />
	<meta property="og:site_name" content="Stepan.Technology" />
	<title>Part 1: Pushing a transition &middot; Stepan.Technology</title>
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" media="only screen and (min-width: 1001px)" href="/assets/css/desktop.css" />
	<link rel="stylesheet" type="text/css" media="only screen and (max-width: 1000px)" href="/assets/css/mobile.css" />
	<link href="/assets/css/genericons.css" type="text/css" rel="stylesheet" />
	<link href="/assets/css/syntax.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
	<link rel="apple-touch-icon" href="http://www.stepan.technology/assets/images/icon.jpeg">
	<link rel="shortcut icon" href="http://www.stepan.technology/assets/images/favicon.ico">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.stepan.technology/atom.xml">
</head>
<body>
	<header class="clean" style="background-image: url(/assets/images/cover.jpg);height: 350px;">
	
	<!--<label class="menu" for="_1">
	<span class="genericon genericon-menu"></span>
</label>
<input id="_1" type="checkbox">
<div class="menu-content">
	<div class="menu" style="background-color: #777; z-index: -1;"></div>
	
</div>-->
<div class="social-links">
	
	<a href="https://twitter.com/stepanhruda" target="_blank" title="stepanhruda on Twitter"><span class="genericon genericon-twitter"></span></a>
	
	<a href="https://github.com/stepanhruda" target="_blank" title="stepanhruda on GitHub"><span class="genericon genericon-github"></span></a>
	
	<a href="http://www.stepan.technology/atom.xml" target="_blank" title="RSS feed"><span class="genericon genericon-feed"></span></a>
	
</div>
	<div id="post-title">
		<a href="http://www.stepan.technology">
			<h3>Stepan.Technology</h3>
		</a>
	</div>
	<div id="post-info">
		<h1>Part 1: Pushing a transition</h1>
		
			<h2>Putting the easy into easy transitioning</h2>
		
		<a class="site-title" href="https://twitter.com/stepanhruda"><img src="/assets/images/icon.jpeg" class="site-icon-small">Stepan Hruda</a> on 01 June 2014
	</div>
	<div id="nav-icon" style="bottom: 60px;">
		<a class="scroll" data-speed="1000" href="#article"><span class="genericon genericon-expand"></span></a>
	</div>
</header>
<div id="article">
	<blockquote>
<p>This article is part of the <a href="../transition-with-stptransitions/">Transition with STPTransitions</a> series.</p>
</blockquote>

<p>This is the first of the couple of articles, where I am going to show how to write transitions in a straightforward way using <a href="http://github.com/stepanhruda/STPTransitions">STPTransitions</a>.</p>

<h3>Object rotate</h3>

<p>Let&#39;s say I want to build an &quot;object rotate&quot; transition, similar to the one in Keynote. Watch this.</p>

<div><img class="centered" src="/media/2014-06-01-pushing-a-transition/spin-slow.gif" alt="A GIF is worth over 9000 words. This seems like a useful transition." />
<blockquote style="border-left: 10px solid #D5D5D5;">A GIF is worth over 9000 words. This seems like a useful transition.</blockquote> </div>

<h3>How to STPTransition</h3>

<p>To create such a <em>STPTransition</em>, we don&#39;t have to do much: subclass <em>STPTransition</em> and implement two methods.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">- (NSTimeInterval)transitionDuration;

- (void)animateFromView:(UIView *)fromView
                 toView:(UIView *)toView
        inContainerView:(UIView *)containerView
    executeOnCompletion:(void (^)(BOOL))onCompletion;
</code></pre></div>
<p>Obviously, the second method is what brings the meat home. But let&#39;s get the duration out of the way first.</p>

<h3>Duration</h3>

<p>After doing a lot of difficult math, I decided our animation is going to last half a second.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">- (NSTimeInterval)transitionDuration {
    return 0.5f;
}
</code></pre></div>
<p><em>Note: The navigation bar automatically gets this duration when animating itself. We should also reuse it when animating the transition.</em></p>

<h3>Animation</h3>

<p>Onwards to explore the documentation and/or signature for the other method.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">- (void)animateFromView:(UIView *)fromView
                 toView:(UIView *)toView
        inContainerView:(UIView *)containerView
    executeOnCompletion:(void (^)(BOOL))onCompletion;
</code></pre></div>
<p>It gives us a <em>fromView</em> and <em>toView</em>. In our case the <em>fromView</em> is going to be rotating and disappearing to the left; <em>toView</em> is going to be appearing and rotating from the right.</p>

<p><em>containerView</em> is the superview in which the animation takes place. At the beginning of the transition, the <em>toView</em> (which we&#39;re trying to end up with) isn&#39;t on screen yet. We need to add it to the <em>containerView</em> when we want it to appear. We can do that right away, since there&#39;s no delay for it to start appearing. Also, the <em>toView</em> is hidden and rotated at the beginning of the animation. (Don&#39;t worry about the transform too much; trust me, it rotates correctly.)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">- (void)animateFromView:(UIView *)fromView
                 toView:(UIView *)toView
        inContainerView:(UIView *)containerView
    executeOnCompletion:(void (^)(BOOL))onCompletion {
    toView.alpha = 0.0f;

    CGFloat offsetX = CGRectGetWidth(containerView.bounds) / 2.5f;
    toView.layer.transform = [self rotatedRightToX:offsetX];

    [containerView addSubview:toView];

...

- (CATransform3D)rotatedRightToX:(CGFloat)offsetX {
    CATransform3D rotatePositively = CATransform3DMakeRotation(M_PI_2, 0, 1, 0);
    CATransform3D moveRight = CATransform3DMakeTranslation(offsetX, 0, 0);
    return CATransform3DConcat(rotatePositively, moveRight);
}
</code></pre></div>
<p>Having set up the inital state, now we can animate. The alphas of both the views change as if they were crossfading (<em>1.0f-&gt;0.0f</em> and <em>0.0f-&gt;1.0f</em>, respectively). Simultaneously, their 3D transforms change to rotate. (Again, don&#39;t worry about the transform&#39;s implementation too much if you don&#39;t want to.)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    [UIView animateWithDuration:self.transitionDuration
                     animations:
     ^{
         fromView.alpha = 0.0f;
         fromView.layer.transform = [self rotatedLeftToX:offsetX];

         toView.alpha = 1.0f;
         toView.layer.transform = CATransform3DIdentity;
     }

...

- (CATransform3D)rotatedLeftToX:(CGFloat)offsetX {
    CATransform3D rotateNegatively = CATransform3DMakeRotation(-M_PI_2, 0, 1, 0);
    CATransform3D moveLeft = CATransform3DMakeTranslation(-offsetX, 0, 0);
    return CATransform3DConcat(rotateNegatively, moveLeft);
}
</code></pre></div>
<h3>Completion block</h3>

<p><em>STPTransition</em>&#39;s animate method has one more argument: <em>onCompletion</em>. It is a completion block that we need to execute when we&#39;re done animating, so some automatic cleanup (like calling <em>viewDidAppear:</em> and <em>viewDidDisappear:</em> on the controllers involved; seems useful, right?) can happen. Let&#39;s execute it in the animation&#39;s completion block. </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">                completion:
^(BOOL finished) {
         onCompletion(finished);

         fromView.alpha = 1.0f;
         toView.alpha = 1.0f;

         fromView.layer.transform = CATransform3DIdentity;
         toView.layer.transform = CATransform3DIdentity;
}];
</code></pre></div>
<p><em>Note: It also seems like good manners to clean up after ourselves and change the transforms and alphas back to what they were before. We don&#39;t want our views to have a hangover. Nobody likes hangovers.</em></p>

<h3>Push, Mrs. Johnson, push</h3>

<p>It&#39;s time to see what we built. Using our newly created <em>STPRotateFadeTransition</em> is as simple as this.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">[self.navigationController pushViewController:secondViewController
                              usingTransition:[STPRotateFadeTransition new]];
</code></pre></div>
<div><img class="centered" src="/media/2014-06-01-pushing-a-transition/spin-regular.gif" alt="" />
 </div>

<p>There we have it. A reusable custom transition, decoupled from our view controller code. And we really didn&#39;t need to create any extra files along the way.</p>

<p>Next part: <a href="../putting-a-transition-into-reverse-gear/">Putting a transition into reverse gear</a></p>

<p>If you liked what you read here, <a href="https://twitter.com/stepanhruda">follow me on Twitter</a>.</p>

<hr>

<p>Complete transition&#39;s code for reference:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// STPRotateFadeTransition.h

@interface STPRotateFadeTransition : STPTransition

@end

// STPRotateFadeTransition.m

#import &quot;STPRotateFadeTransition.h&quot;

@implementation STPRotateFadeTransition 

- (NSTimeInterval)transitionDuration {
    return 0.5f;
}

- (void)animateFromView:(UIView *)fromView
                 toView:(UIView *)toView
        inContainerView:(UIView *)containerView
    executeOnCompletion:(void (^)(BOOL))onCompletion {
    toView.alpha = 0.0f;

    CGFloat offsetX = CGRectGetWidth(containerView.bounds) / 2.5f;

    toView.layer.transform = [self rotatedRightToX:offsetX];

    [containerView addSubview:toView];

    [UIView animateWithDuration:self.transitionDuration
                     animations:
     ^{
         fromView.alpha = 0.0f;
         toView.alpha = 1.0f;

         fromView.layer.transform = [self rotatedLeftToX:offsetX];
         toView.layer.transform = CATransform3DIdentity;
     }
                     completion:
     ^(BOOL finished) {
         onCompletion(finished);

         fromView.alpha = 1.0f;
         toView.alpha = 1.0f;

         fromView.layer.transform = CATransform3DIdentity;
         toView.layer.transform = CATransform3DIdentity;
     }];
}

- (CATransform3D)rotatedLeftToX:(CGFloat)offsetX {
    CATransform3D rotateNegatively = CATransform3DMakeRotation(-M_PI_2, 0, 1, 0);
    CATransform3D moveLeft = CATransform3DMakeTranslation(-offsetX, 0, 0);
    return CATransform3DConcat(rotateNegatively, moveLeft);
}

- (CATransform3D)rotatedRightToX:(CGFloat)offsetX {
    CATransform3D rotatePositively = CATransform3DMakeRotation(M_PI_2, 0, 1, 0);
    CATransform3D moveRight = CATransform3DMakeTranslation(offsetX, 0, 0);
    return CATransform3DConcat(rotatePositively, moveRight);
}

@end
</code></pre></div>
<p><em>Note: If you try to use this exact example transition, make sure your view controllers&#39; background colors are set to <strong>clearColor</strong> and the navigation controller handles your background instead. Otherwise the view controller background will rotate with everything else, which doesn&#39;t look that good. There are number of ways to approach this, but none of this has much to do with what this article is about.</em></p>

</div>

<footer class="clean" style="background-image: url(/assets/images/cover.jpg);height: 75%; min-height: 500px;">
	<div id="nav-icon" style="top: 25px;">
		<a class="scroll" data-speed="1000" href="#article"><span class="genericon genericon-collapse"></span></a>
	</div>
	<div id="post-info">
		<h3>Featured post</h3>
		<a href="/articles/prototyping-transitions">
			<h1>Part 5: Prototyping transitions</h1>
			
				<h2>Putting the easy into easy transitioning</h2>
			
		</a>
	</div>
	<p class="copyright">&copy;2014, <a href="http://www.stepan.technology" target="_blank">Stepan Hruda</a>. <a href="http://creativecommons.org/licenses/by-nc/2.5" target="_blank">Some rights reserved</a>.</p>
</footer>

<script src="/assets/js/smooth-scroll.js"></script>
</body>
</html>